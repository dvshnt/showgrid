{% extends 'base.html' %}

{% block title %}Showgrid{% endblock %}

{% block content %}
<section>
	<div class="previous"></div>
	<div class="next"></div>
	<table>
		<thead>
			<tr>
				<td>
					Venue
				</td>
				<td class='day-0'></td>
				<td class='day-1'></td>
				<td class='day-2'></td>
				<td class='day-3'></td>
				<td class='day-4'></td>
				<td class='day-5'></td>
				<td class='day-6'></td>
			</tr>
		</thead>
		<tbody>
		
		</tbody>
</section>
{% endblock %}

{% block scripts %}
<script>
	(function() {
		
		var weekdays = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
		var months = [
			"january", "february", "march", "april", "may", "june", "july", 
			"august", "september", "october", "november", "december"
		];

		var d = new Date();
		for (var i=0; i < 7; i++) {
			var currentDay = addDays(d, i);
			var dayOfWeek = weekdays[ currentDay.getDay() ];
			var month = months[ currentDay.getMonth() ];
			var dayOfMonth = currentDay.getDate();

			var pod = $("td.day-" + i);
			pod.html(dayOfWeek + " " + month + " " + dayOfMonth);
			pod.data({ "day-num": i, "day-of-week": dayOfWeek });
		}

		$(document).ready(function() {
			
			$.ajax({
	            url: "http://localhost:8000/i/grid/",
	            type: "GET",
	            crossDomain: true,
	            dataType: "json",
	            success: function (grid) {
	            	var table = $("tbody");

	                $.each(grid, function(key, value) {
	                	table.append(getVenueRow(value));
	                });
	            },
	            error: function (xhr, status) {
	                alert("error");
	            }
	        });
		
		});

		function addDays(date, days) {
		    var result = new Date(date);
		    result.setDate(date.getDate() + days);
		    return result;
		}

		function getVenueRow(venue) {
			var shows = getVenueShows(venue);

			var html = "<tr>" +
						   	"<td>" +
						    	"<div class='venue'>" +
							    	"<div class='"+ venue.image_url +" pic'></div>" +
							    	"<div class='name'>"+ venue.name +"</div>" +
							    	"<div class='address'>" +
							    		venue.address.street +"<br>" +
							    		venue.address.city +", " +
							    		venue.address.state + " " +
							    		venue.address.zip_code +
							    	"</div>" +
						    	"</div>" +
						    "</td>" +
						    "<td class='show-day-0'>" + shows[0] + "</td>" +
						    "<td class='show-day-1'>" + shows[1] + "</td>" +
						    "<td class='show-day-2'>" + shows[2] + "</td>" +
						    "<td class='show-day-3'>" + shows[3] + "</td>" +
						    "<td class='show-day-4'>" + shows[4] + "</td>" +
						    "<td class='show-day-5'>" + shows[5] + "</td>" +
						    "<td class='show-day-6'>" + shows[6] + "</td>" +
						"</tr>";
			return html;
		}

		function getVenueShows(venue) {
			var shows = [];
			$.each(venue.shows, function(i, value) {
				var columnNum = $.data("td.day-" + i, "day-num");
				var columnDayOfWeek = $.data("td.day-" + i, "day-of-week");

				
			});

			return shows;
		}

	})();
</script>
{% endblock %}