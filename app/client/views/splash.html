{% extends "base.html" %}
	
{% load static from staticfiles %}

{% block content %}

{% if issue %}
<a class="issue" href="http://showgrid.com/issue/{{ issue.id }}">
	<section class="issue list" style="background-image:url('media/{{ issue.banner }}');">
		<h4>This Week's Digest</h4>
		<span>
			Week of {{ issue.start_date|date:"F jS" }}&nbsp; | &nbsp;{{ issue.tag }}
		</span>
	</section>
</a>
{% endif %}

<section>
	<h3>Introducing</h3>
	<h4>Showgrid Weekly Digest</h4>
	<p>
		While we work on building out the rest of the site, we've put together a weekly newsletter to help you stay up to date about who is playing in town for the upcoming week. A real simple remedy for the missing Showgrid calendar.
	</p>
	<p>
		Every Sunday, we will bring you a selection of shows for the week accompanied by a Spotify playlist. The playlist will be made up of the artists that are playing in town that week. 
	</p>
	<p>
		The newsletter will feature commentary about some of the shows, and ideally, you will read it and want to see some live music! Sign up below. 
	</p>

	<form class="form" method="post" action="http://localhost:8000/v1/signup?ref={{ref}}">
		{% csrf_token %} 
		<input type="email" name="email" placeholder="Email address" required/><input type="submit" value="Submit"/>
		<div class="msg">
			There is something here that once wasn't.
		</div>
	</form>
</section>

<section>
	<h3 class="fade">Coming Soon...</h3>
	<ul>
		<li>
			<svg class="icon icon-calendar"><use xlink:href="#icon-calendar"></use></svg><br>
		</li>
		<li>
			<svg class="icon icon-article"><use xlink:href="#icon-article"></use></svg><br>
		</li>
		<li>
			<svg class="icon icon-playlist"><use xlink:href="#icon-playlist"></use></svg><br>
		</li>
	</ul>
	<p>
		In an effort to grow Showgrid into a more useful and exciting place to get information, we are putting her under the proverbial knife.
	</p>
	<p>
		A few things we can talk about that are in the works.
	</p>
	<p>
		First, we will release a series of <b class="art">articles</b> focusing on music history. To start, these articles will talk exclusively of Nashville, and the rich music history we are surrounded by. They will be fresh and new and help inform your understanding of why Nashville is Nashville.
	</p>
	<p>
		Second, we will consistently put out a series of themed <b class="play">playlists</b>. Playlists will be in the fashion of 'Songs about Star Wars' or maybe even 'Songs That Started Wars'. We may even venture to try and create a <i>mood</i> with these playlists. Like 'Songs To Make Love To With Your Socks On'.
 	</p>
 	<p>
 		Finally, we will have the standard music <b class="cal">calendar</b> that you came here for in the first place. .
 	</p>
 	<p>
 		Until then, enjoy the newsletter and tell all of your friends. I mean all of them. 
 	</p>
 	<p>
 		<br>
 		<i>Thanks, Davis.</i>
 	</p>
</section>
{% endblock %}


{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
<script>
	$(function() {

		//hang on event of form with id=myform
		$(".form").submit(function(e) {
			e.preventDefault();

			if ($(this).hasClass("success")) return;

			if (!validateEmail($(".form input[type=email]").val())) {
				$(".form").addClass("error");

				$(".form .msg").html("Enter a valid email address.")

				setTimeout(function() {
					$(".form").removeClass("error");
				}, 5000);
				return;
			}

			//get the action-url of the form
			var actionurl = e.currentTarget.action;
		
			$(".form").addClass("request");

			//do your own request an handle the results
			$.ajax({
				url: actionurl,
				type: 'POST',
				dataType: 'json',
				data: $(".form").serialize(),
				complete: function(data) {
					if (data.status === 200) {
						$(".form").addClass("success");
						$(".form input[type=submit]").val("Thanks for signing up! See you soon.");
					}

					// Already entered this eail.
					if (data.status === 409) {
						$(".form").addClass("error");

						$(".form .msg").html("You've already signed up with this email address.")

						setTimeout(function() {
							$(".form").removeClass("error");
						}, 5000);
						return;
					}
				}
			});

		});

		function validateEmail(str) {
			var lastAtPos = str.lastIndexOf('@');
		    var lastDotPos = str.lastIndexOf('.');
		    return (lastAtPos < lastDotPos && lastAtPos > 0 && str.indexOf('@@') == -1 && lastDotPos > 2 && (str.length - lastDotPos) > 2);
		}

	});

</script>
{% endblock %}
