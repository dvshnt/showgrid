{% extends "base.html" %}
	
{% load static from staticfiles %}

{% block content %}

{% if issue %}
<a class="issue" href="http://localhost:8000/issue/{{ issue.id }}">
	<section class="issue list" style="background-image:url('media/{{ issue.banner }}');">
		<h4>This Week's Digest</h4>
		<span>
			Week of {{ issue.start_date|date:"F jS" }}&nbsp; | &nbsp;Issue #{{ issue.id }}
		</span>
	</section>
</a>
{% endif %}

<section>
	<h3>Introducing</h3>
	<h4>Showgrid Weekly Digest</h4>
	<p>
		As Showgrid searches for its soul in the desolate landscape of shoddy live music calendars, we bring you something to help curb your appetite. A weekly email newsletter!
	</p>
	<p>
		Every Sunday, we will bring you a selection of shows for the week accompanied by a Spotify playlist. You can receive the digest via phone or email.
	</p>
	<p>
		I think you can sense why we would pair a playlist and a list of shows so I'll spare you any further explanation. Sign up below. 
	</p>

	<form class="form" method="post" action="http://localhost:8000/v1/signup">
		
		<input type="email" name="email" placeholder="Email address" required/><input type="submit" value="Submit"/>
		<div class="msg">
			There is something here that once wasn't.
		</div>
	</form>
</section>

<section>
	<h3 class="fade">Coming Soon...</h3>
	<ul>
		<li>
			<svg class="icon icon-calendar"><use xlink:href="#icon-calendar"></use></svg><br>
		</li>
		<li>
			<svg class="icon icon-article"><use xlink:href="#icon-article"></use></svg><br>
		</li>
		<li>
			<svg class="icon icon-playlist"><use xlink:href="#icon-playlist"></use></svg><br>
		</li>
	</ul>
	<p>
		In an effort to grow Showgrid into a more useful and exciting place to get information, we are putting her under the proverbial knife.
	</p>
	<p>
		A few things we can talk about that are in the works.
	</p>
	<p>
		Firstly, we will release a series of <b class="art">articles</b> focusing on music history. Heavy articles will be monthly, sprinkled between by articles about 'lighter weight' music history topics. To start, these articles will talk exclusively of Nashville, and the rich music history we are surrounded by. We truly believe that to be a fully capable citizen, you must at least know that Bob Dylan recorded his magnum opus, <i>Blonde on Blonde</i>, here in this city.
	</p>
	<p>
		Secondly, we will consistently put out a series of themed <b class="play">playlists</b>. Playlists will be in the fashion of 'Songs about Star Wars' or maybe even 'Songs That Started Wars'. We may even venture to try and create a <i>mood</i> with these playlists. Like 'Songs To Make Love To With Your Socks On'. You get it. Enough of that.
 	</p>
 	<p>
 		And lastly, we will have the standard music <b class="cal">calendar</b> that you came here for in the first place. It will likely look the same, but all links from the calendar will now link to pages within the site where you can gather more info about the show you are exploring. This will include songs, artist bios, articles about said artists, pictures and a fire breathing dragon to scare you into buying tickets.
 	</p>
 	<p>
 		Until then, enjoy the newsletter and tell all of your friends. I mean all of them. 
 	</p>
 	<p>
 		<br>
 		<i>Thanks, Davis.</i>
 	</p>
</section>
{% endblock %}


{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
<script>
	$(function() {

		//hang on event of form with id=myform
		$(".form").submit(function(e) {
			e.preventDefault();

			if ($(this).hasClass("success")) return;

			if (!validateEmail($(".form input[type=email]").val())) {
				$(".form").addClass("error");

				$(".form .msg").html("Enter a valid email address.")

				setTimeout(function() {
					$(".form").removeClass("error");
				}, 5000);
				return;
			}

			//get the action-url of the form
			var actionurl = e.currentTarget.action;
		
			$(".form").addClass("request");

			//do your own request an handle the results
			$.ajax({
				url: actionurl,
				type: 'POST',
				dataType: 'json',
				data: $(".form").serialize(),
				complete: function(data) {
					if (data.status === 200) {
						$(".form").addClass("success");
						$(".form input[type=submit]").val("Thanks for signing up! See you soon.");
					}

					// Already entered this eail.
					if (data.status === 409) {
						$(".form").addClass("error");

						$(".form .msg").html("You've already signed up with this email address.")

						setTimeout(function() {
							$(".form").removeClass("error");
						}, 5000);
						return;
					}
				}
			});

		});

		function validateEmail(str) {
			var lastAtPos = str.lastIndexOf('@');
		    var lastDotPos = str.lastIndexOf('.');
		    return (lastAtPos < lastDotPos && lastAtPos > 0 && str.indexOf('@@') == -1 && lastDotPos > 2 && (str.length - lastDotPos) > 2);
		}

	});

</script>
{% endblock %}
